import pandas as pd
from sklearn.neighbors import LocalOutlierFactor

# Specify the input file path
input_file = '/home/hadoop/IST3134/preprocessed_data.csv'

# Load the data using Pandas
data_df = pd.read_csv(input_file)

# Convert the data to float and handle non-convertible values
data_df['SPEED'] = pd.to_numeric(data_df['SPEED'], errors='coerce')
data_df['TRAVEL_TIME'] = pd.to_numeric(data_df['TRAVEL_TIME'], errors='coerce')

# Drop rows with NaN values in the 'SPEED' or 'TRAVEL_TIME' columns
data_df.dropna(subset=['SPEED', 'TRAVEL_TIME'], inplace=True)

# Select only the 'SPEED' and 'TRAVEL_TIME' columns for the LOF algorithm
data = data_df[['SPEED', 'TRAVEL_TIME']].values

# Run the LOF algorithm on the data
lof = LocalOutlierFactor(n_neighbors=5)
lof_scores = lof.fit_predict(data)

# Add the LOF scores and the 'BOROUGH' column to the DataFrame
data_df['lof_score'] = lof_scores

# Print the first few rows of the DataFrame
print(data_df.head())

# Specify the output file path
output_file = '/home/hadoop/IST3134/outputpig.csv'

# Write results to CSV file
data_df.to_csv(output_file, index=False)

# Read the output CSV file into a new DataFrame and print the first few rows
output_df = pd.read_csv(output_file)
print(output_df.head())
